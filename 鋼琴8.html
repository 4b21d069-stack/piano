<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ğŸ¹ ç·šä¸Šé‹¼ç´æ¨¡æ“¬å™¨ Piano Studio</title>
  <meta name="description" content="å…è²»ç·šä¸Šé‹¼ç´èˆ‡å¼¦æ¨‚æ¨¡æ“¬å™¨ï¼Œæ”¯æ´æ»‘å‹•å½ˆå¥ã€å»¶éŸ³ã€ç¯€æ‹å™¨ã€å¤šç¨®éŸ³è‰²ï¼ˆé‹¼ç´ã€è±ç´ã€å‰ä»–ã€è²æ–¯ã€å¼¦æ¨‚ç­‰ï¼‰ï¼Œé‚„èƒ½å­¸ç¿’æ¨‚ç†çŸ¥è­˜ã€‚" />
  <meta name="keywords" content="ç·šä¸Šé‹¼ç´, é‹¼ç´æ¨¡æ“¬å™¨, å‰ä»–, è±ç´, å¼¦æ¨‚, éŸ³æ¨‚æ•™å­¸, æ¨‚ç†, é‹¼ç´å­¸ç¿’" />
  <style>
    body {
      margin: 0;
      background: #0c0c0c;
      color: #eee;
      font-family: "Noto Sans TC", sans-serif;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    header {
      background: #181818;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.6);
      padding: 16px 40px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    header h1 {
      font-size: 1.8rem;
      color: #fff;
      letter-spacing: 1px;
      font-weight: 600;
      margin: 0;
    }
    main {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px 0;
      overflow-x: auto;
    }
    #piano {
      display: flex;
      position: relative;
      user-select: none;
      padding: 10px;
    }
    .white-key, .black-key {
      border: 1px solid #333;
      position: relative;
      transition: all 0.1s ease;
    }
    .white-key {
      width: 40px;
      height: 200px;
      background: linear-gradient(to bottom, #fff 0%, #e5e5e5 100%);
      margin: 0 1px;
      z-index: 1;
      border-radius: 0 0 4px 4px;
    }
    .white-key.active {
      transform: translateY(4px);
      background: linear-gradient(to bottom, #ccc 0%, #999 100%);
      box-shadow: inset 0 4px 8px rgba(0, 0, 0, 0.4);
    }
    .black-key {
      width: 26px;
      height: 120px;
      background: linear-gradient(to bottom, #222 0%, #000 100%);
      position: absolute;
      top: 0;
      margin-left: -13px;
      z-index: 2;
      border-radius: 0 0 4px 4px;
    }
    .black-key.active {
      transform: translateY(3px);
      background: linear-gradient(to bottom, #111 0%, #222 100%);
      box-shadow: inset 0 3px 6px rgba(255,255,255,0.3);
    }
    .settings {
      display: flex;
      gap: 14px;
      align-items: center;
    }
    label { font-size: 0.9rem; }
    input[type="range"], select, button {
      background: #111;
      color: #eee;
      border: 1px solid #333;
      border-radius: 4px;
      padding: 4px 6px;
      cursor: pointer;
    }
    button:hover, select:hover { background: #333; }
    footer {
      background: #1b1b1b;
      padding: 36px 10%;
      font-size: 1rem;
      color: #ccc;
      line-height: 1.6;
    }
    footer h3 {
      color: #fff;
      font-weight: 600;
      font-size: 1.2rem;
      margin-bottom: 12px;
    }
  </style>
</head>
<body>
  <header>
    <h1>ğŸ¹ Piano Studio ç·šä¸Šé‹¼ç´æ¨¡æ“¬å™¨</h1>
    <div class="settings">
      <label>éŸ³é‡ï¼š</label>
      <input type="range" id="volume" min="0" max="100" value="70">

      <label>éŸ³è‰²ï¼š</label>
      <select id="soundSelect">
        <option value="piano">é‹¼ç´</option>
        <option value="harp">è±ç´</option>
        <option value="violin">å°æç´</option>
        <option value="cello">å¤§æç´</option>
        <option value="guitar">å‰ä»–</option>
        <option value="bass">è²æ–¯</option>
        <option value="strings">å¼¦æ¨‚çµ„</option>
      </select>

      <label>å»¶éŸ³ï¼š</label>
      <button id="sustainBtn">Off</button>

      <label>ç¯€æ‹å™¨(BPM)ï¼š</label>
      <input type="number" id="bpm" min="40" max="240" value="80" style="width:60px;">
      <button id="metronomeBtn">é–‹å§‹</button>
    </div>
  </header>

  <main>
    <div id="piano"></div>
  </main>

  <footer>
    <h3>ğŸµ æ¨‚ç†åŸºç¤çŸ¥è­˜</h3>
    <p><strong>éŸ³éšï¼ˆScaleï¼‰</strong> æ˜¯éŸ³æ¨‚çš„åŸºç¤ï¼Œåƒ C å¤§èª¿çš„éŸ³ç¬¦ä¾åºç‚ºï¼šCã€Dã€Eã€Fã€Gã€Aã€Bã€‚</p>
    <p><strong>å…¨éŸ³èˆ‡åŠéŸ³ï¼š</strong> ç›¸é„°å…©å€‹ç™½éµä¹‹é–“è‹¥æœ‰é»‘éµï¼Œè·é›¢ç‚ºå…¨éŸ³ï¼›è‹¥æ²’æœ‰é»‘éµï¼Œå‰‡ç‚ºåŠéŸ³ã€‚</p>
    <p><strong>å’Œå¼¦ï¼ˆChordï¼‰ï¼š</strong> åŒæ™‚å½ˆå¥ä¸‰å€‹æˆ–ä»¥ä¸Šä¸åŒçš„éŸ³ï¼Œå°±èƒ½å½¢æˆå’Œå¼¦ï¼Œä¾‹å¦‚ C å¤§å’Œå¼¦ï¼ˆC-E-Gï¼‰ã€‚</p>
    <p><strong>ç¯€æ‹ï¼ˆBeatï¼‰ï¼š</strong> æ˜¯éŸ³æ¨‚çš„ç¯€å¥å–®ä½ï¼Œæ¯ä¸€å°ç¯€çš„ç¯€æ‹æ•¸æ±ºå®šéŸ³æ¨‚çš„é€Ÿåº¦èˆ‡ç¯€å¥æ„Ÿã€‚</p>
  </footer>

  <script>
    const whiteOrder = ['C','D','E','F','G','A','B'];
    const blackMap = {'C':'C#','D':'D#','F':'F#','G':'G#','A':'A#'};
    const octaves = [2,3,4,5,6];
    const notes = [];

    for (let o of octaves) {
      for (let w of whiteOrder) {
        notes.push(w+o);
        if (blackMap[w]) notes.push(blackMap[w]+o);
      }
    }

    const piano = document.getElementById("piano");
    notes.forEach(note=>{
      if (!note.includes('#')) {
        const w=document.createElement("div");
        w.className="white-key";
        w.dataset.note=note;
        piano.appendChild(w);
      }
    });
    notes.forEach((note,idx)=>{
      if(note.includes('#')){
        const parentIndex=notes.slice(0,idx).filter(n=>!n.includes('#')).length-1;
        const w=piano.children[parentIndex];
        if(w){
          const b=document.createElement("div");
          b.className="black-key";
          b.dataset.note=note;
          w.appendChild(b);
        }
      }
    });

    const ctx=new(window.AudioContext||window.webkitAudioContext)();
    let currentVolume=0.7;
    let sustainOn=false;
    let currentSound="piano";
    const volume=document.getElementById("volume");
    const sustainBtn=document.getElementById("sustainBtn");
    const soundSelect=document.getElementById("soundSelect");

    volume.addEventListener("input",()=>{currentVolume=volume.value/100;});
    sustainBtn.addEventListener("click",()=>{
      sustainOn=!sustainOn;
      sustainBtn.textContent=sustainOn?"On":"Off";
    });
    soundSelect.addEventListener("change",()=>{currentSound=soundSelect.value;});

    const soundURLs={
      piano:"https://cdn.pixabay.com/audio/2022/03/15/audio_991eb2bbd3.mp3",
      harp:"https://cdn.pixabay.com/audio/2022/03/09/audio_39a1ec11c2.mp3",
      violin:"https://cdn.pixabay.com/audio/2022/03/15/audio_3c17e4bb3e.mp3",
      cello:"https://cdn.pixabay.com/audio/2022/03/15/audio_77ad7e5b2.mp3",
      guitar:"https://cdn.pixabay.com/audio/2022/03/15/audio_9a2f09b27d.mp3",
      bass:"https://cdn.pixabay.com/audio/2022/03/15/audio_013d69e222.mp3",
      strings:"https://cdn.pixabay.com/audio/2022/03/15/audio_b3a0b7bde3.mp3",
      click:"https://cdn.pixabay.com/audio/2022/03/15/audio_click.mp3"
    };

    async function playNote(note){
      const url=soundURLs[currentSound];
      const response=await fetch(url);
      const arrayBuffer=await response.arrayBuffer();
      const audioBuffer=await ctx.decodeAudioData(arrayBuffer);
      const source=ctx.createBufferSource();
      source.buffer=audioBuffer;
      const gain=ctx.createGain();
      gain.gain.setValueAtTime(currentVolume,ctx.currentTime);
      if(sustainOn){
        gain.gain.exponentialRampToValueAtTime(0.01,ctx.currentTime+3);
      }
      source.connect(gain).connect(ctx.destination);
      source.start();
      return source;
    }

    let isMouseDown=false;

    function pressKey(key){
      if(!key.classList.contains("active")){
        key.classList.add("active");
        playNote(key.dataset.note);
      }
    }

    piano.addEventListener("mousedown",e=>{
      isMouseDown=true;
      const key=e.target.closest(".white-key, .black-key");
      if(!key)return;
      pressKey(key);
    });

    piano.addEventListener("mouseup",()=>{
      isMouseDown=false;
      piano.querySelectorAll(".active").forEach(k=>k.classList.remove("active"));
    });

    piano.addEventListener("mousemove",e=>{
      if(!isMouseDown) return;
      const key=e.target.closest(".white-key, .black-key");
      if(key) pressKey(key);
    });

    piano.addEventListener("mouseleave",()=>{
      // æ»‘é¼ é›¢é–‹éµç›¤ â†’ ç«‹å³æ”¾é–‹
      isMouseDown=false;
      piano.querySelectorAll(".active").forEach(k=>k.classList.remove("active"));
    });

    // ç¯€æ‹å™¨
    let metronomeInterval=null;
    const bpmInput=document.getElementById("bpm");
    const metronomeBtn=document.getElementById("metronomeBtn");

    metronomeBtn.addEventListener("click",()=>{
      if(metronomeInterval){
        clearInterval(metronomeInterval);
        metronomeInterval=null;
        metronomeBtn.textContent="é–‹å§‹";
      } else {
        const bpm=parseInt(bpmInput.value)||80;
        const interval=60000/bpm; // æ¯«ç§’
        metronomeInterval=setInterval(async()=>{
          // æ’­æ”¾é»æ“ŠéŸ³
          const response=await fetch(soundURLs.click);
          const arrayBuffer=await response.arrayBuffer();
          const audioBuffer=await ctx.decodeAudioData(arrayBuffer);
          const source=ctx.createBufferSource();
          source.buffer=audioBuffer;
          source.connect(ctx.destination);
          source.start();
        }, interval);
        metronomeBtn.textContent="åœæ­¢";
      }
    });
  </script>
</body>
</html>
